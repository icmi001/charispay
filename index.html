<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CharisPay</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="https://i.imgur.com/jT9Dl9w.png" sizes="192x192">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#2C003E,#4B0082);color:#fff;min-height:100vh;}
#authScreen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;z-index:9999;background:#2C003E;}
.card{background:#fff;color:#000;padding:40px;border-radius:16px;width:90%;max-width:380px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.3);}
.card img{height:70px;margin-bottom:20px;}
input,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;}
input{background:#f1f1f1;}
button{background:#00d478;color:#fff;font-weight:600;cursor:pointer;}
#googleBtn{background:#4285f4 !important;margin-top:15px;}
#main{padding:20px;display:none;}
h3{color:#BDA0FF;}
</style>
</head>
<body>

<div id="authScreen">
  <div class="card">
    <img src="https://i.imgur.com/pG7paVl.png" alt="CharisPay">
    <h3>Welcome to CharisPay</h3>
    <form id="loginForm">
      <input type="email" placeholder="Email" required>
      <input type="password" placeholder="Password" required>
      <button type="submit">Log In</button>
    </form>
    <button id="googleBtn"><i class="fab fa-google"></i> Sign in with Google</button>
    <p style="margin-top:15px;font-size:14px;">
      <a href="#" id="forgotPass" style="color:#dc3545;">Forgot Password?</a>
    </p>
  </div>
</div>

<div id="main">
  <h3>Dashboard</h3>
  <p>Welcome, <strong><span id="userEmail"></span></strong>!</p>
  <button onclick="supabase.auth.signOut().then(()=>location.reload())">Logout</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module">
const supabase = window.supabase.createClient(
  'https://gbuqxitxyezjptyeveud.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdidXF4aXR4eWV6anB0eWV2ZXVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NTQ2NzQsImV4cCI6MjA3NzIzMDY3NH0.hiagI1wklBr-LJgDho4srBk7ObH7NozwaKXNJbFzqWc'
);

document.getElementById('loginForm').onsubmit = async e => {
  e.preventDefault();
  const email = e.target[0].value, pass = e.target[1].value;
  const { error } = await supabase.auth.signInWithPassword({email, password: pass});
  if (error) alert(error.message);
  else initApp();
};

document.getElementById('googleBtn').onclick = () => {
  supabase.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo: window.location.origin }
  });
};

document.getElementById('forgotPass').onclick = e => {
  e.preventDefault();
  const email = prompt('Enter your email');
  if (email) {
    supabase.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin })
      .then(() => alert('Check your email!'))
      .catch(err => alert(err.message));
  }
};

supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') initApp();
});

async function initApp() {
  document.getElementById('authScreen').style.display = 'none';
  document.getElementById('main').style.display = 'block';
  const { data: { user } } = await supabase.auth.getUser();
  document.getElementById('userEmail').textContent = user.email;
}

// Auto-login if session exists
supabase.auth.getSession().then(({ data }) => {
  if (data.session) initApp();
});
</script>
</body>
</html>
